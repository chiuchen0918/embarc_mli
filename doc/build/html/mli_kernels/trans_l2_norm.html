

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>L2 Normalization Prototype and Function List &mdash; embARC Machine Learning Library 2.0 2.00 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Element-wise Kernels Group" href="elemw_grp.html" />
    <link rel="prev" title="Softmax Prototype and Function List" href="trans_softmax.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> embARC Machine Learning Library 2.0
          

          
          </a>

          
            
            
              <div class="version">
                2.00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whats_new/whats_new.html">What’s New in MLI 2.0 ?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mli_api_data/mli_api_data.html">MLI API Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="mli_kernels.html">MLI Kernels (Operators)</a></li>
<li class="toctree-l1"><a class="reference internal" href="convolution_grp.html">Convolution Kernels Group</a></li>
<li class="toctree-l1"><a class="reference internal" href="rec_fully_con_grp.html">Recurrent and Fully Connected Kernels Group</a></li>
<li class="toctree-l1"><a class="reference internal" href="pooling_grp.html">Pooling Kernels Group</a></li>
<li class="toctree-l1"><a class="reference internal" href="diverse_kernels_grp.html">Diverse Kernels Group</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="transform_grp.html">Transform (Activation) Kernels Group</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="trans_lut.html">Look-Up Tables (LUT) Manipulation Prototypes and Function List</a></li>
<li class="toctree-l2"><a class="reference internal" href="trans_relu.html">ReLU Prototype and Function List</a></li>
<li class="toctree-l2"><a class="reference internal" href="trans_leaky_relu.html">Leaky ReLU Prototype and Function List</a></li>
<li class="toctree-l2"><a class="reference internal" href="trans_param_relu.html">Parametric ReLU (PReLU) Prototype and Function List</a></li>
<li class="toctree-l2"><a class="reference internal" href="trans_sigmoid.html">Sigmoid Prototype and Function List</a></li>
<li class="toctree-l2"><a class="reference internal" href="trans_tanh.html">TanH Prototype and Function List</a></li>
<li class="toctree-l2"><a class="reference internal" href="trans_softmax.html">Softmax Prototype and Function List</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">L2 Normalization Prototype and Function List</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functions">Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conditions">Conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#result">Result</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="elemw_grp.html">Element-wise Kernels Group</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_movement/data_movement.html">Data Movement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utility_functions/utility_functions.html">Utility Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platform_specific/platform_hint_sum.html">Platform Specific Details</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">embARC Machine Learning Library 2.0</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="transform_grp.html">Transform (Activation) Kernels Group</a> &raquo;</li>
        
      <li>L2 Normalization Prototype and Function List</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/mli_kernels/trans_l2_norm.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="l2-normalization-prototype-and-function-list">
<span id="l2-norm-prot"></span><h1>L2 Normalization Prototype and Function List<a class="headerlink" href="#l2-normalization-prototype-and-function-list" title="Permalink to this headline">¶</a></h1>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This kernel normalizes data across the specified dimension using L2 norm according to the following
formula:</p>
<div class="math notranslate nohighlight">
\[y_{i} = \frac{x_{i}}{\sqrt{epsilon + \sum_{j}{x_{j}}^{2}}}\]</div>
<p>Where:</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(x_{i}-i_{th}\)</span> <em>-</em> value in input data subset</p>
<p><span class="math notranslate nohighlight">\(x_{j}-j_{th}\)</span> <em>-</em> value in the same input data subset</p>
<p><span class="math notranslate nohighlight">\(y_{i}-i_{th}\)</span> <em>-</em> value in output data subset</p>
<p><span class="math notranslate nohighlight">\(epsilon\)</span> <em>-</em> lower bound to prevent division on zero</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">epsilon</span></code> tensor currently isn’t used in integer-based versions of the kernel (<code class="docutils literal notranslate"><span class="pre">fx16</span></code>, <code class="docutils literal notranslate"><span class="pre">sa8</span></code>)
and is preserved only for possible future use.</p>
</div>
<p>L2 normalization function might be applied to the whole tensor, or along a specific axis. In the
first case all input values are involved in the calculation of each output value. If the axis is
specified, then the function is applied to each slice along the specific axis independently.</p>
<p>This kernel uses a look-up table (LUTs) to perform data transformation.
See <a class="reference internal" href="trans_lut.html#lut-prot"><span class="std std-ref">Look-Up Tables (LUT) Manipulation Prototypes and Function List</span></a> section and the pseudo-code sample for more details on LUT structure preparation.
Use the following functions for the purpose:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">mli_krn_l2_normalize_get_lut_size</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">mli_krn_l2_normalize_create_lut</span></code></p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<p>Kernels which implement L2 normalization functions have the following prototype:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">mli_status</span> <span class="n">mli_krn_l2_normalize_</span><span class="o">&lt;</span><span class="n">data_format</span><span class="o">&gt;</span><span class="p">(</span>
   <span class="k">const</span> <span class="n">mli_tensor</span> <span class="o">*</span><span class="n">in</span><span class="p">,</span>
   <span class="k">const</span> <span class="n">mli_tensor</span> <span class="o">*</span><span class="n">epsilon</span><span class="p">,</span>
   <span class="k">const</span> <span class="n">mli_lut</span> <span class="o">*</span><span class="n">lut</span><span class="p">,</span>
   <span class="k">const</span> <span class="n">mli_l2_normalize_cfg</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span>
   <span class="n">mli_tensor</span> <span class="o">*</span><span class="n">out</span><span class="p">);</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">data_format</span></code> is one of the data formats listed in Table <a class="reference internal" href="../mli_api_data/data_formats.html#mli-data-fmts"><span class="std std-ref">MLI Data Formats</span></a> and the function
parameters are shown in the following table:</p>
<table class="colwidths-auto docutils align-center" id="id1">
<caption><span class="caption-text">L2 Normalization Function Parameters</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">in</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mli_tensor</span> <span class="pre">*</span></code></p></td>
<td><p>[IN] Pointer to constant input tensor.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">epsilon</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mli_tensor</span> <span class="pre">*</span></code></p></td>
<td><p>[IN] For future use.
Pointer to tensor with epsilon value.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">lut</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mli_lut</span> <span class="pre">*</span></code></p></td>
<td><p>[IN] Pointer to a valid LUT table
structure prepared for L2 normalization.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cfg</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mli_l2_normalize_cfg</span> <span class="pre">*</span></code></p></td>
<td><p>[IN] Pointer to L2 Normalize parameters structure.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">out</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mli_tensor</span> <span class="pre">*</span></code></p></td>
<td><p>[IN | OUT] Pointer to output tensor.
Result is stored here</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">mli_l2_normalize_cfg</span></code> is defined as:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="n">mli_prelu_cfg</span> <span class="n">mli_l2_normalize_cfg</span><span class="p">;</span>
</pre></div>
</div>
<p>See Table <a class="reference internal" href="trans_param_relu.html#t-mli-prelu-cfg-desc"><span class="std std-ref">mli_prelu_cfg Structure Field Description</span></a> for more details.</p>
<table class="colwidths-auto docutils align-center" id="id2">
<caption><span class="caption-text">List of Available L2 Normalization Functions</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Function Name</strong></p></th>
<th class="head"><p><strong>Details</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mli_krn_l2_normalize_sa8</span></code></p></td>
<td><p>All tensors data format: <strong>sa8</strong></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mli_krn_l2_normalize_fx16</span></code></p></td>
<td><p>All tensors data format: <strong>fx16</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="conditions">
<h2>Conditions<a class="headerlink" href="#conditions" title="Permalink to this headline">¶</a></h2>
<p>Ensure that you satisfy the following general conditions before calling the function:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">in</span></code> and <code class="docutils literal notranslate"><span class="pre">out</span></code> tensors must be valid (see <a class="reference internal" href="../mli_api_data/data_structures.html#mli-tnsr-struc"><span class="std std-ref">mli_tensor Structure Field Descriptions</span></a>)
and satisfy data requirements of the selected version of the kernel.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">epsilon</span></code> tensor isn’t used and can be passed as a <code class="docutils literal notranslate"><span class="pre">NULL</span></code> pointer or other value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">in</span></code> and <code class="docutils literal notranslate"><span class="pre">out</span></code> tensors must be of the same shapes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lut</span></code> structure must be valid and prepared for the L2 Normalization activation function (see <a class="reference internal" href="trans_lut.html#lut-prot"><span class="std std-ref">Look-Up Tables (LUT) Manipulation Prototypes and Function List</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mem_stride</span></code> of the innermost dimension must be equal to 1 for all the tensors.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">axis</span></code> parameter of <code class="docutils literal notranslate"><span class="pre">cfg</span></code> structure might be negative and must be less than <code class="docutils literal notranslate"><span class="pre">in</span></code> tensor rank.</p></li>
</ul>
</div></blockquote>
<p>For <strong>sa8</strong> versions of kernel, in addition to general conditions, ensure that you satisfy
the following quantization conditions before calling the function:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">in</span></code> tensor must be quantized on the tensor level. This
implies that the tensor contains a single scale factor and a single zero offset.</p></li>
<li><p>Zero offset of <code class="docutils literal notranslate"><span class="pre">in</span></code> tensor must be within [-128, 127] range.</p></li>
</ul>
</div></blockquote>
<p>Ensure that you satisfy the platform-specific conditions in addition to those listed above
(see the <a class="reference internal" href="../platform_specific/platform_hint_sum.html#platform-spec-chptr"><span class="std std-ref">Platform Specific Details</span></a> chapter).</p>
</div>
<div class="section" id="result">
<h2>Result<a class="headerlink" href="#result" title="Permalink to this headline">¶</a></h2>
<p>These functions modify:</p>
<blockquote>
<div><ul class="simple">
<li><p>Memory pointed by <code class="docutils literal notranslate"><span class="pre">out.data.mem</span></code> field.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">el_params</span></code> field of <code class="docutils literal notranslate"><span class="pre">out</span></code> tensor.</p></li>
</ul>
</div></blockquote>
<p>It is assumed that all the other fields and structures are properly populated
to be used in calculations and are not modified by the kernel.</p>
<p>The range of this function is (-1, 1).  Depending on the data type, quantization parameters of the output
tensor are configured in the following way:</p>
<blockquote>
<div><ul>
<li><p><strong>fx16</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">out.el_params.fx.frac_bits</span></code> is set to 15. Hence, the maximum representable value of  L2 normalization is
equivalent to 0.999969482421875 (not 1.0).</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>sa8</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">out.el_params.sa.zero_point.mem.i16</span></code> is set to 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">out.el_params.sa.scale.mem.i16</span></code> is set to 1</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">out.el_params.sa.scale_frac_bits.mem.i8</span></code> is set to 7</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>The kernel supports in-place computation. It means that <code class="docutils literal notranslate"><span class="pre">out</span></code> and <code class="docutils literal notranslate"><span class="pre">in</span></code> tensor structures
can point to the same memory with the same memory strides but without shift.
It can affect performance for some platforms.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Only an exact overlap of starting address and memory stride of the <code class="docutils literal notranslate"><span class="pre">in</span></code> and <code class="docutils literal notranslate"><span class="pre">out</span></code>
tensors is acceptable. Partial overlaps result in undefined behavior.</p>
</div>
<p>Depending on the debug level (see section <a class="reference internal" href="../mli_api_data/error_codes.html#err-codes"><span class="std std-ref">Error Codes</span></a>) this function performs a parameter
check and returns the result as an <code class="docutils literal notranslate"><span class="pre">mli_status</span></code> code as described in section <a class="reference internal" href="../mli_api_data/data_structures.html#kernl-sp-conf"><span class="std std-ref">Kernel Specific Configuration Structures</span></a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="elemw_grp.html" class="btn btn-neutral float-right" title="Element-wise Kernels Group" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="trans_softmax.html" class="btn btn-neutral float-left" title="Softmax Prototype and Function List" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, Synopsys, Inc

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>